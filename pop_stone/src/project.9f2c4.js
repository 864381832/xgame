require=function a(r,s,l){function c(t,e){if(!s[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(h)return h(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var o=s[t]={exports:{}};r[t][0].call(o.exports,function(e){return c(r[t][1][e]||e)},o,o.exports,a,r,s,l)}return s[t].exports}for(var h="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({AudioMgr:[function(e,t,n){"use strict";cc._RF.push(t,"464f4x4gmtH5Iayg+ZV2XsO","AudioMgr"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],CellModel:[function(e,t,n){"use strict";cc._RF.push(t,"9440daco/1GBZC4p5IFz9t/","CellModel"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=o;var i=e("./ConstValue");function o(e){this.baseType=i.BASE_TYPE.Empty,this.featureType=i.FEATURE_TYPE.Empty,this.x=0,this.y=0,e&&(this.baseType=e.baseType,this.featureType=e.featureType,this.x=e.x,this.y=e.y)}o.prototype.init=function(e){this.baseType=type},o.prototype.setXY=function(e,t){this.x=e,this.y=t},o.prototype.getXY=function(){return{x:this.x,y:this.y}},o.prototype.clone=function(){var e=new o;return e.baseType=this.baseType,e.featureType=this.featureType,e.x=this.x,e.y=this.y,e},t.exports=n.default,cc._RF.pop()},{"./ConstValue":"ConstValue"}],CellView:[function(e,t,n){"use strict";cc._RF.push(t,"d632cO0GeZDfZ3o7ADLB/Tn","CellView");var i,o=e("../models/CellModel"),a=((i=o)&&i.__esModule,function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../models/ConstValue")));var r=e("EffectView");cc.Class({extends:cc.Component,properties:{baseTypeSprites:{default:[],type:[cc.SpriteFrame]},colorlessSprites:{default:[],type:[cc.SpriteFrame]},featureTypeColorSprite:{default:null,type:cc.SpriteFrame},featureTypeClearSprite:{default:null,type:cc.SpriteFrame},baseTypeSprite:{default:null,type:cc.Sprite}},initWithCellModel:function(e){this.cellModel=e,this.effectName=null;var t=this.effectNode=null;this.cellModel.featureType==a.FEATURE_TYPE.Color?(t=this.featureTypeColorSprite,this.effectName=a.EFFECT_COLOR):this.cellModel.featureType==a.FEATURE_TYPE.Colorless?(t=this.colorlessSprites[this.cellModel.baseType-1],this.effectName=a.EFFECT_COLORLESS):t=this.cellModel.featureType==a.FEATURE_TYPE.Clear?this.featureTypeClearSprite:this.baseTypeSprites[this.cellModel.baseType-1],this.baseTypeSprite.spriteFrame=t,this.addEffect()},changeBaseType:function(e){this.cellModel.featureType==a.FEATURE_TYPE.Colorless&&(r.instance.playEffectNormal(a.EFFECT_COLORLESS_CHANGE,this.node.position),this.baseTypeSprite.spriteFrame=this.colorlessSprites[this.cellModel.baseType-1])},addEffect:function(){this.effectName&&(this.effectNode=r.instance.spawnEffectLoop(this.effectName),this.effectNode.position=this.node.position,this.effectNode.getComponent(cc.Animation).play())},unuse:function(){this.resetEffect()},resetEffect:function(){null!=this.effectNode&&(r.instance.despawnEffectLoop(this.effectName,this.effectNode),this.effectName=null,this.effectNode=null)},runActionMove:function(e){this.node.runAction(e),null!=this.effectNode&&this.effectNode.runAction(e.clone())},setScale:function(e){this.node.scale=e,null!=this.effectNode&&(this.effectNode.scale=e)},setOpacity:function(e){this.node.opacity=e,null!=this.effectNode&&(this.effectNode.opacity=e)},setPosition:function(e){this.node.position=e,null!=this.effectNode&&(this.effectNode.position=e)}}),cc._RF.pop()},{"../models/CellModel":"CellModel","../models/ConstValue":"ConstValue",EffectView:"EffectView"}],ConstValue:[function(e,t,n){"use strict";cc._RF.push(t,"f510akCpL1L06CAd91j4xdp","ConstValue"),Object.defineProperty(n,"__esModule",{value:!0}),n.generateLevelInfo=function(e,t){var n={};n.score=t||0,e<=ConstValue.LEVEL_CONFIG.length?(n.level=ConstValue.LEVEL_CONFIG[e-1].level,n.target=ConstValue.LEVEL_CONFIG[e-1].target):(n.level=e,n.target=5e3*(e-ConstValue.LEVEL_CONFIG.length)+ConstValue.LEVEL_CONFIG[ConstValue.LEVEL_CONFIG.length-1].target);var i=Math.floor(3*Math.random()),o=Math.floor(3*Math.random()),a=Math.floor(3*Math.random());n.girdModel=new GridModel,n.girdModel.init(10,10,i,o,a)};n.BASE_TYPE={Empty:0,Red:1,Yellow:2,Blue:3,Green:4,Pink:5},n.FEATURE_TYPE={Empty:0,Color:1,Colorless:2,Clear:3},n.CELL_WIDTH=72,n.CELL_HEIGHT=72,n.EFFECT_SELECTED="EffectSelected",n.EFFECT_COLOR="EffectColor",n.EFFECT_COLORLESS="EffectColorless",n.EFFECT_COLORLESS_CHANGE="EffectColorlessChange",n.EFFECT_EXPLOD_COLOR="EffectExplodColor",n.EFFECT_BRUSH="EffectBrush",n.EFFECT_HAMMER="EffectHammer",n.ITEM_BRUSH="ItemBrush",n.ITEM_HAMMER="ItemHammer",n.ITEM_SHUFFLE="ItemShuffle",n.ITEM_DIAMOND="ItemDiamond",n.PRICE_BRUSH=100,n.PRICE_HAMMER=50,n.PRICE_SHUFFLE=50,n.DATA_LAST_DIAMOND_DATE="DataLastDiamondDate",n.DATA_LAST_DIAMOND_COUNT="DataLastDiamondCount",n.DAILY_DIAMOND_COUNT=3,n.DATA_LAST_GIFT_DATE="DataLastGiftDate",n.DATA_LAST_GIFT_COUNT="DataLastGiftCount",n.DATA_GIFT_COUNT=1,n.DATA_LEVEL_INFO="DataLevelInfo",n.LEADERBOARD_SCORE_WORLD="ScoreWorld",n.LEVEL_CONFIG=[{level:1,target:1200,colorCount:1,colorLessCount:0,clearCount:0},{level:2,target:3e3,colorCount:1,colorLessCount:2,clearCount:0},{level:3,target:5e3,clearCount:2},{level:4,target:7500},{level:5,target:1e4},{level:6,target:12500},{level:7,target:15e3},{level:8,target:18e3},{level:9,target:2e4},{level:10,target:22e3}];cc._RF.pop()},{}],DialogDailyGift:[function(e,t,n){"use strict";cc._RF.push(t,"6401cFXUeNINaBI4hwVByra","DialogDailyGift");var o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../models/ConstValue"));var a=e("UserDataMgr"),i=e("ScreenMgr"),r=e("UtilsFB"),s=e("UtilsCommon"),l=e("EffectMgr");cc.Class({extends:e("DialogView"),properties:{},start:function(){},onEnterBegin:function(e){this.updateLeftCount()},close:function(){this.node.active=!1},onBtnClickClose:function(){this.close()},onBtnClickGet:function(){if(this.leftGetCount<=0)i.instance.showMessage("Chances are used up, please come tommorrow.");else{this.close();var e=s.getScreenshotBase64(s.getCameraMain());r.chooseAsync(e).then(function(){this.onShareSuccess()}.bind(this)).catch(function(e){})}},onShareSuccess:function(){this.lastGetCount+=1;var e=(new Date).toDateString();a.instance.incrementData(o.ITEM_SHUFFLE,1),a.instance.incrementData(o.ITEM_DIAMOND,50),a.instance.incrementData(o.ITEM_HAMMER,2),a.instance.setData(o.DATA_LAST_GIFT_COUNT,this.lastGetCount),a.instance.setData(o.DATA_LAST_GIFT_DATE,e),a.instance.setDataToFB(),l.instance.playEffect("EffectGift",cc.v2(0,0))},updateLeftCount:function(){var e=new Date,t=a.instance.getDataString(o.DATA_LAST_GIFT_DATE);this.lastGetCount=a.instance.getDataNumber(o.DATA_LAST_GIFT_COUNT),""!=t&&(e=new Date(t)),e.setHours(0,0,0,0);var n=new Date;n.setHours(0,0,0,0);var i=Math.floor((n-e)/864e5);0<i?this.lastGetCount=0:i<0&&(this.lastGetCount=o.DATA_GIFT_COUNT),this.leftGetCount=Math.max(o.DATA_GIFT_COUNT-this.lastGetCount,0)}}),cc._RF.pop()},{"../models/ConstValue":"ConstValue",DialogView:"DialogView",EffectMgr:"EffectMgr",ScreenMgr:"ScreenMgr",UserDataMgr:"UserDataMgr",UtilsCommon:"UtilsCommon",UtilsFB:"UtilsFB"}],DialogGetDiamond:[function(e,t,n){"use strict";cc._RF.push(t,"3d75dZLmypFpYH4FhTPOZUZ","DialogGetDiamond");var o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../models/ConstValue"));var a=e("UserDataMgr"),i=e("ScreenMgr"),r=e("UtilsFB"),s=e("UtilsCommon");cc.Class({extends:e("DialogView"),properties:{btnGet:{default:null,type:cc.Node}},onEnterBegin:function(e){this.updateLeftCount()},onBtnClickGet:function(){if(this.leftGetCount<=0)i.instance.showMessage("Chances are used up, please come tommorrow.");else{this.close();var e=s.getScreenshotBase64(s.getCameraMain());r.chooseAsync(e).then(function(){this.onShareSuccess()}.bind(this)).catch(function(e){})}},onBtnClickNo:function(){this.close()},close:function(){this.node.active=!1},onShareSuccess:function(){this.lastGetCount+=1;var e=(new Date).toDateString();a.instance.incrementData(o.ITEM_DIAMOND,100),a.instance.setData(o.DATA_LAST_DIAMOND_COUNT,this.lastGetCount),a.instance.setData(o.DATA_LAST_DIAMOND_DATE,e),a.instance.setDataToFB()},updateLeftCount:function(){var e=new Date,t=a.instance.getDataString(o.DATA_LAST_DIAMOND_DATE);this.lastGetCount=a.instance.getDataNumber(o.DATA_LAST_DIAMOND_COUNT),""!=t&&(e=new Date(t)),e.setHours(0,0,0,0);var n=new Date;n.setHours(0,0,0,0);var i=Math.floor((n-e)/864e5);0<i?this.lastGetCount=0:i<0&&(this.lastGetCount=o.DAILY_DIAMOND_COUNT),this.leftGetCount=Math.max(o.DAILY_DIAMOND_COUNT-this.lastGetCount,0),this.btnGet.getComponentInChildren(cc.Label).string="Get 100 Diamonds ("+this.leftGetCount+")"}}),cc._RF.pop()},{"../models/ConstValue":"ConstValue",DialogView:"DialogView",ScreenMgr:"ScreenMgr",UserDataMgr:"UserDataMgr",UtilsCommon:"UtilsCommon",UtilsFB:"UtilsFB"}],DialogLeaderboard:[function(e,t,n){"use strict";cc._RF.push(t,"5b1e5JvUNNPlIHef/khusZY","DialogLeaderboard");var i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../models/ConstValue"));cc.Class({extends:e("DialogView"),properties:{leaderboardView:{default:null,type:e("LeaderboardView")}},onEnterBegin:function(e){this.leaderboardView.showLeaderboard(i.LEADERBOARD_SCORE_WORLD)}}),cc._RF.pop()},{"../models/ConstValue":"ConstValue",DialogView:"DialogView",LeaderboardView:"LeaderboardView"}],DialogPause:[function(e,t,n){"use strict";cc._RF.push(t,"21e0dFFvIlEjbo9wBTK+zcr","DialogPause");var i=e("ScreenMgr"),o=e("ScreenGame");cc.Class({extends:cc.Component,properties:{},start:function(){},onBtnClickHome:function(){this.node.active=!1,o.instance.gridView.saveLevelInfo(),i.instance.gotoScreen("ScreenHome")},onBtnClickClose:function(){this.node.active=!1}}),cc._RF.pop()},{ScreenGame:"ScreenGame",ScreenMgr:"ScreenMgr"}],DialogView:[function(e,t,n){"use strict";cc._RF.push(t,"73ab6A+9zhOD4KJ6bJePv5I","DialogView"),cc.Class({extends:cc.Component,properties:{},onEnterBegin:function(e){},onExitBegin:function(e){},close:function(){this.node.active=!1}}),cc._RF.pop()},{}],EffectMgr:[function(e,t,n){"use strict";cc._RF.push(t,"028f9hLs3ZD26Y/kRcemd4/","EffectMgr");var i=cc.Class({extends:cc.Component,properties:{effectPrefabs:{default:[],type:[cc.Prefab]}},statics:{instance:null},onLoad:function(){(i.instance=this).effectMap={};for(var e=0;e<this.effectPrefabs.length;e++)this.initEffect(this.effectPrefabs[e])},playEffect:function(e,t){var n=null;if(e in this.effectMap){var i=this.effectMap[e];0<i.prefabPool.size()?n=i.prefabPool.get():(n=cc.instantiate(i.effectPrefab)).getComponent(cc.Animation).on("finished",function(e,t){i.prefabPool.put(n)},this),n.setParent(i.effectParent),n.position=t,n.getComponent(cc.Animation).play()}return n},initEffect:function(e){var t=e.name,n={};n.effectPrefab=e,n.effectParent=this.generateEffectParent(t),n.prefabPool=new cc.NodePool(t),this.effectMap[t]=n},generateEffectParent:function(e){var t=new cc.Node(e);return t.setParent(this.node),t.position=cc.v2(0,0),t}});cc._RF.pop()},{}],EffectView:[function(e,t,n){"use strict";cc._RF.push(t,"7c0ecgLl9xHr77FwZY059IM","EffectView");var i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../models/ConstValue"));var o=cc.Class({extends:cc.Component,properties:{effectSelectedPrefab:{default:null,type:cc.Prefab},effectColorPrefab:{default:null,type:cc.Prefab},effectColorlessPrefab:{default:null,type:cc.Prefab},effectColorlessChangePrefab:{default:null,type:cc.Prefab},effectExplodPrefabs:{default:[],type:[cc.Prefab]},effectExplodColor:{default:null,type:cc.Prefab},effectBrush:{default:null,type:cc.Prefab},effectHammer:{default:null,type:cc.Prefab}},statics:{instance:null},onLoad:function(){(o.instance=this).effectLoopMap={},this.effectNormalMap={},this.initEffectLoop(i.EFFECT_COLOR,this.effectColorPrefab),this.initEffectLoop(i.EFFECT_COLORLESS,this.effectColorlessPrefab),this.initEffectNormal(i.EFFECT_COLORLESS_CHANGE,this.effectColorlessChangePrefab),this.initEffectLoop(i.EFFECT_SELECTED,this.effectSelectedPrefab),this.initEffectExplod(),this.initEffectNormal(i.EFFECT_EXPLOD_COLOR,this.effectExplodColor),this.initEffectNormal(i.EFFECT_BRUSH,this.effectBrush),this.initEffectNormal(i.EFFECT_HAMMER,this.effectHammer)},initEffectExplod:function(){this.effectExplodArray=[];for(var e=this.generateEffectParent("EffectExplod"),t=0;t<this.effectExplodPrefabs.length;t++){var n="EffectExplod_"+t,i={};i.effectPrefab=this.effectExplodPrefabs[t],i.effectParent=e,i.prefabPool=new cc.NodePool(n),this.effectExplodArray.push(i)}},initEffectNormal:function(e,t){var n={};n.effectPrefab=t,n.effectParent=this.generateEffectParent(e),n.prefabPool=new cc.NodePool(e),this.effectNormalMap[e]=n},initEffectLoop:function(e,t){var n={};n.effectPrefab=t,n.effectParent=new cc.Node(e),n.effectParent.setParent(this.node),n.effectParent.position=cc.v2(0,0),n.prefabPool=new cc.NodePool(e),n.playing=!1,this.effectLoopMap[e]=n},generateEffectParent:function(e){var t=new cc.Node(e);return t.setParent(this.node),t.position=cc.v2(0,0),t},playEffectNormal:function(e,t){var n=null;if(e in this.effectNormalMap){var i=this.effectNormalMap[e];0<i.prefabPool.size()?n=i.prefabPool.get():(n=cc.instantiate(i.effectPrefab)).getComponent(cc.Animation).on("finished",function(e,t){i.prefabPool.put(n)},this),n.setParent(i.effectParent),n.position=t,n.getComponent(cc.Animation).play()}return n},playEffectExplod:function(e,t){if(e<this.effectExplodArray.length){var n=this.effectExplodArray[e],i=null;0<n.prefabPool.size()?i=n.prefabPool.get():(i=cc.instantiate(n.effectPrefab)).getComponent(cc.Animation).on("finished",function(e,t){n.prefabPool.put(i)},this),i.setParent(n.effectParent),i.position=t,i.getComponent(cc.Animation).play()}},spawnEffectLoop:function(e){var t=null;if(e in this.effectLoopMap){var n=this.effectLoopMap[e];(t=0<n.prefabPool.size()?n.prefabPool.get():cc.instantiate(n.effectPrefab)).setParent(n.effectParent)}return t},despawnEffectLoop:function(e,t){e in this.effectLoopMap&&this.effectLoopMap[e].prefabPool.put(t)},playEffectLoop:function(e,t){if(0<t.length&&e in this.effectLoopMap){for(var n=this.effectLoopMap[e],i=0;i<t.length;i++){var o=this.spawnEffectLoop(e);o.position=t[i],o.getComponent(cc.Animation).play()}n.playing=!0}},stopEffectLoop:function(e){if(e in this.effectLoopMap){for(var t=this.effectLoopMap[e],n=t.effectParent.childrenCount-1;0<=n;n--){var i=t.effectParent.children[n];i.getComponent(cc.Animation).stop(),t.prefabPool.put(i)}t.playing=!1}}});cc._RF.pop()},{"../models/ConstValue":"ConstValue"}],GameControl:[function(e,t,n){"use strict";cc._RF.push(t,"6bafdcH/YtAmIwULJ5AXuCB","GameControl"),cc.Class({extends:cc.Component,properties:{gridView:{default:null,type:e("GridView")}},onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},onTouchStart:function(e){var t=e.getTouches()[0].getLocation();this.gridView.onTouchStart(t)},onTouchEnd:function(e){var t=e.getTouches()[0].getLocation();this.gridView.onTouchEnd(t)}}),cc._RF.pop()},{GridView:"GridView"}],GameMgr:[function(e,t,n){"use strict";cc._RF.push(t,"fed0348PbJCQY99a/sn5PAX","GameMgr");var i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../models/ConstValue"));var o=e("UtilsFB");cc.Class({extends:cc.Component,properties:{},start:function(){o.init(i.LEADERBOARD_SCORE_WORLD)}}),cc._RF.pop()},{"../models/ConstValue":"ConstValue",UtilsFB:"UtilsFB"}],GridModellTest:[function(e,t,n){"use strict";cc._RF.push(t,"108b7/4TztAWqjYbswCufnZ","GridModellTest");var i,o=e("./GridModel"),a=(i=o)&&i.__esModule?i:{default:i};cc.Class({extends:cc.Component,properties:{},start:function(){this.GridModel=new a.default,this.GridModel.init(8,10),this.GridModel.findAllElimination(),this.GridModel.printInfo();var e=JSON.stringify(this.GridModel);console.log(e),this.GridModel=JSON.parse(e),console.log(JSON.stringify(this.GridModel))}}),cc._RF.pop()},{"./GridModel":"GridModel"}],GridModel:[function(e,t,n){"use strict";cc._RF.push(t,"48f61A5FdxMAYWK6c6N8u0A","GridModel"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=a;var i,o=e("./CellModel"),f=(i=o)&&i.__esModule?i:{default:i},d=e("./ConstValue");var C=e("UtilsCommon");function a(){this.cells=null,this.width=0,this.height=0,this.baseTypeCount=0}a.prototype.initFromJson=function(e){this.width=e.width,this.height=e.height,this.baseTypeCount=e.baseTypeCount,this.cells=[];for(var t=0;t<this.height;t++){this.cells[t]=[];for(var n=0;n<this.width;n++){var i=e.cells[t][n];if(null!=i){var o=new f.default(i);this.cells[t][n]=o}else this.cells[t][n]=null}}},a.prototype.init=function(e,t,n,i,o){this.debugLog("init: "+e+"x"+t),this.width=e,this.height=t,this.baseTypeCount=Object.keys(d.BASE_TYPE).length,this.cells=[];for(var a=0;a<this.height;a++){this.cells[a]=[];for(var r=0;r<this.width;r++){var s=new f.default;s.baseType=this.getBaseTypeRandom(),s.setXY(r,a),this.cells[a][r]=s}}var l=[],c=new f.default;c.featureType=d.FEATURE_TYPE.Color,this.initCellsFeature(l,c,n);var h=new f.default;h.featureType=d.FEATURE_TYPE.Colorless,h.baseType=this.getBaseTypeRandom(),this.initCellsFeature(l,h,i);var u=new f.default;u.featureType=d.FEATURE_TYPE.Clear,this.initCellsClear(l,u,o)},a.prototype.initCellsFeature=function(e,t,n){for(var i=this.width*this.height,o=0;o<n;o++){for(var a=0;a=Math.floor(Math.random()*i),e.includes(a););e.push(a);var r={x:a%this.width,y:Math.floor(a/this.height)};this.setCell(r,t.clone())}},a.prototype.initCellsClear=function(e,t,n){for(var i=this.width*this.height,o=0;o<n;o++){for(var a=0,r={x:0,y:0};r={x:(a=Math.floor(Math.random()*i))%this.width,y:Math.floor(a/this.height)},e.includes(a)||0==r.y;);e.push(a),this.setCell(r,t.clone())}},a.prototype.checkClear=function(){for(var e=[],t=0;t<this.width;t++){var n={x:t,y:0},i=this.getVaildCell(n);null!=i&&i.featureType==d.FEATURE_TYPE.Clear&&(this.eliminateCell(n),e.push(n))}return e},a.prototype.changeColorless=function(e){var t={};t.baseType=e,t.cellPosArray=[];for(var n=0;n<this.height;n++)for(var i=0;i<this.width;i++){var o={x:i,y:n},a=this.getVaildCell(o);null!=a&&a.featureType==d.FEATURE_TYPE.Colorless&&(a.baseType=t.baseType,t.cellPosArray.push(o))}return t},a.prototype.checkElimination=function(){for(var e=[],t=0;t<this.height;t++)for(var n=0;n<this.width;n++){for(var i={x:n,y:t},o=!1,a=e.length-1;0<=a;a--)if(this.checkCellPosInArray(i,e[a].cellPosArray)){o=!0;break}if(!o){var r=this.findElimination(i);2<=r.cellPosArray.length&&e.push(r)}}return e},a.prototype.onCellClick=function(e){var t=this.getVaildCell(e),n={eliminateSuccess:!1};return null!=t&&(t.featureType==d.FEATURE_TYPE.Color?n=this.onCellClickColor(e):t.baseType!=d.BASE_TYPE.Empty&&(n=this.onCellClickBaseType(e))),n},a.prototype.onCellClickBaseType=function(e){var t=this.findElimination(e);return this.eliminateElimination(t)},a.prototype.onCellClickColor=function(e){var t={};t.baseType=d.BASE_TYPE.Empty,t.cellPosArray=[e];for(var n=this.getAroundCellPos8(e),i=0;i<n.length;i++){var o=this.getVaildCell(n[i]);null!=o&&o.featureType!=d.FEATURE_TYPE.Clear&&t.cellPosArray.push(o.getXY())}return this.eliminateElimination(t)},a.prototype.onCellBrushed=function(e){var t=[],n=this.getVaildCell(e);if(null!=n)for(var i=this.getAroundCellPos8(e),o=0;o<i.length;o++){var a=i[o];if(null!=this.getVaildCell(a)){var r=n.clone();this.setCell(a,r),t.push(r)}}return t},a.prototype.onCellHammered=function(e){return null!=this.getVaildCell(e)&&(this.cells[e.y][e.x]=null),[e]},a.prototype.onShuffle=function(){for(var e={},t=[],n=0;n<this.height;n++)for(var i=0;i<this.width;i++){var o={x:i,y:n};if(this.checkCellPosVaild(o)){var a=n*this.width+i;t.push(a)}}e.originArray=t,e.processArrays=[];for(var r=0;r<3;r++){var s=t.slice();C.shuffleArray(s),e.processArrays.push(s)}for(var l=e.processArrays[e.processArrays.length-1],c=[],h=0;h<this.height;h++)c[h]=[];for(var u=0;u<e.originArray.length;u++){var f=e.originArray[u],d={x:f%this.width,y:Math.floor(f/this.width)},p=this.getVaildCell(d),g=l[u],y={x:g%this.width,y:Math.floor(g/this.width)};(c[y.y][y.x]=p).setXY(y.x,y.y)}return this.cells=c,e},a.prototype.eliminateElimination=function(e){if(e.eliminateSuccess=!1,2<=e.cellPosArray.length){e.eliminateSuccess=!0;for(var t=0;t<e.cellPosArray.length;t++){var n=e.cellPosArray[t];this.eliminateCell(n)}}return e},a.prototype.eliminateCell=function(e){this.cells[e.y][e.x]=null},a.prototype.clearCells=function(){for(var e=[],t=0;t<this.height;t++)for(var n=0;n<this.width;n++){var i={x:n,y:t},o=this.getVaildCell(i);null!=o&&(e.push(o),this.eliminateCell(i))}return e},a.prototype.cellsFallDown=function(){for(var e=[],t=0;t<this.width;t++)for(var n=0,i=0;i<this.height;i++){var o={x:t,y:i},a=this.getVaildCell(o);if(null!=a){if(0<n){var r={};r.pos=o,r.fallCount=n,e.push(r);var s=i-n;this.cells[i][t]=null,(this.cells[s][t]=a).setXY(t,s)}}else n+=1}return e},a.prototype.cellsGather=function(){for(var e=Math.floor(this.width/2)-1,t=[],n=0,i=e;0<=i;i--)if(this.checkColumnEmpty(i))n+=1;else if(0<n)for(var o=0;o<this.height;o++){var a={x:i,y:o},r=this.getVaildCell(a);if(null!=r){var s={};s.pos=a,s.gatherCount=n,t.push(s);var l=i+s.gatherCount;this.cells[o][i]=null,(this.cells[o][l]=r).setXY(l,o)}}n=0;for(var c=e+1;c<this.width;c++)if(this.checkColumnEmpty(c))n+=1;else if(0<n)for(var h=0;h<this.height;h++){var u={x:c,y:h},f=this.getVaildCell(u);if(null!=f){var d={};d.pos=u,d.gatherCount=-n,t.push(d);var p=c+d.gatherCount;this.cells[h][c]=null,(this.cells[h][p]=f).setXY(p,h)}}return t},a.prototype.checkColumnEmpty=function(e){for(var t=0;t<this.height;t++){var n={x:e,y:t};if(this.checkCellPosVaild(n))return!1}return!0},a.prototype.findElimination=function(e){var t={};t.baseType=d.BASE_TYPE.Empty,t.cellPosArray=[];var n=this.getVaildCell(e);return null!=n&&n.baseType!=d.BASE_TYPE.Empty&&n.featureType!=d.FEATURE_TYPE.Color&&n.featureType!=d.FEATURE_TYPE.Clear&&(t.baseType=n.baseType,t.cellPosArray=[e],this.findEliminationRecursive(e,t)),t},a.prototype.findEliminationRecursive=function(e,t){for(var n=this.getAroundCellPos4(e),i=0;i<n.length;i++){var o=n[i];if(!this.checkCellPosInArray(o,t.cellPosArray)){var a=this.getVaildCell(o);null==a||a.baseType!=t.baseType&&a.featureType!=d.FEATURE_TYPE.Color||(t.cellPosArray.push(o),this.findEliminationRecursive(o,t))}}},a.prototype.checkCellPosInArray=function(e,t){for(var n=0;n<t.length;n++)if(e.x==t[n].x&&e.y==t[n].y)return!0;return!1},a.prototype.getAroundCellPos8=function(e){return[{x:e.x-1,y:e.y+1},{x:e.x,y:e.y+1},{x:e.x+1,y:e.y+1},{x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x-1,y:e.y-1},{x:e.x,y:e.y-1},{x:e.x+1,y:e.y-1}]},a.prototype.getAroundCellPos4=function(e){return[{x:e.x,y:e.y+1},{x:e.x,y:e.y-1},{x:e.x-1,y:e.y},{x:e.x+1,y:e.y}]},a.prototype.filterVaildCellPos=function(e){var t=[];if(null!=e)for(var n=0;n<e.length;n++){var i=e[n];this.checkCellPosVaild(i)&&t.push(i)}return t},a.prototype.getVaildCell=function(e){var t=null;if(0<=e.x&&e.x<this.width&&0<=e.y&&e.y<this.height){var n=this.cells[e.y][e.x];null!=n&&(t=n)}return t},a.prototype.setCell=function(e,t){t.setXY(e.x,e.y),this.cells[e.y][e.x]=t},a.prototype.checkCellPosVaild=function(e){return!!this.getVaildCell(e)},a.prototype.getBaseTypeRandom=function(){return Math.floor(Math.random()*(this.baseTypeCount-1))+1},a.prototype.printInfo=function(){for(var e="",t=this.height-1;0<=t;t--){e+="\n";for(var n=0;n<this.width;n++)null==this.cells[t][n]?e+="  ":e+=this.cells[t][n].baseType+" "}console.log(e)},a.prototype.debugLog=function(e){console.log("[gm]"+e)},t.exports=n.default,cc._RF.pop()},{"./CellModel":"CellModel","./ConstValue":"ConstValue",UtilsCommon:"UtilsCommon"}],GridView:[function(e,t,n){"use strict";cc._RF.push(t,"7e168+clk5Nqae7PVcrhraI","GridView");var i,g=r(e("../models/ConstValue")),o=e("../models/GridModel"),a=((i=o)&&i.__esModule,r(e("../models/LevelModel")));function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var f=e("UtilsCommon"),s=e("UtilsFB"),y=e("ScoreView"),l=e("UserDataMgr"),c=e("ScreenMgr");cc.Class({extends:cc.Component,properties:{cellViewPrefab:{default:null,type:cc.Prefab},cellParent:{default:null,type:cc.Node},effectView:{default:null,type:e("EffectView")},nodeLevel:{default:null,type:cc.Node},nodeKeepGoing:{default:null,type:cc.Node}},onLoad:function(){this.screenGame=e("ScreenGame"),this.gaming=!1,this.cellViewPool=new cc.NodePool("CellView"),this.cellViews=[],this.allElimination=[],this.touchCellView=null,this.noTouchTime=0,this.hintHighlighting=!1,this.busying=!1,this.lastExplodBaseType=g.BASE_TYPE.Empty,this.brushSelected=!1,this.hammerSelected=!1},update:function(e){this.noTouchTime+=e,this.busying&&(this.noTouchTime=0),!this.hintHighlighting&&this.gaming&&5<this.noTouchTime&&this.highlightElimination()},clearOnExit:function(){for(var e=0;e<this.gridModel.height;e++)for(var t=0;t<this.gridModel.width;t++){var n=this.cellViews[e][t];null!=n&&this.despawnCellView(n)}this.gaming=!1,this.allElimination=!1,this.stopHighlightElimination()},initWithLevelInfo:function(e){this.lastLevelScore=e.lastLevelScore,this.level=e.level,this.score=e.score,this.target=e.target,this.gridModel=e.gridModel,y.instance.initWithLevelInfo(e),this.cellViews=[];for(var t=0;t<this.gridModel.height;t++){this.cellViews[t]=[];for(var n=0;n<this.gridModel.width;n++){var i={x:n,y:t},o=this.gridModel.getVaildCell(i);if(null!=o){var a=this.spawnCellView();a.node.setParent(this.cellParent),a.node.position=this.getCellPosition(i),a.initWithCellModel(o),this.cellViews[t][n]=a}}}this.animationGameStart()},animationGameStart:function(){var i=this,e=Array.from(Array(this.gridModel.width*this.gridModel.height).keys());e=f.shuffleArray(e);for(var t=0;t<this.gridModel.height;t++)for(var n=0;n<this.gridModel.width;n++){var o=e[t*this.gridModel.width+n],a=this.cellViews[t][n];if(null!=a){var r={x:o%this.gridModel.width,y:Math.floor(o/this.gridModel.width)},s=this.getCellPosition(r).mul(.8).add(cc.v2(0,600)).scale(cc.v2(-1,1));a.setPosition(s),a.setScale(.8),a.setOpacity(0)}}for(var c=[],l=function(l){for(var e=0,t=0;t<i.gridModel.width;t++)i.cellViews[l][t]&&(e+=1);if(0<e){var n=cc.callFunc(function(){for(var e=0;e<this.gridModel.width;e++){var t={x:e,y:l},n=this.cellViews[l][e];if(null!=n){var i=this.getCellPosition(t),o=cc.moveTo(.5,i).easing(cc.easeIn(3)),a=cc.scaleTo(.5,1).easing(cc.easeIn(3)),r=cc.fadeIn(.5).easing(cc.easeIn(3)),s=cc.spawn(o,a,r);n.runActionMove(s)}}},i);c.push(cc.delayTime(.2)),c.push(n)}},h=0;h<this.gridModel.height;h++)l(h);var u=cc.callFunc(this.gameStart,this);c.push(u),this.busying=!0,this.node.runAction(cc.sequence(c))},gameStart:function(){this.busying=!1,this.gaming=!0,this.checkElimination(),this.noTouchTime=0},checkElimination:function(){return this.allElimination=this.gridModel.checkElimination(),this.allElimination.length<=0&&this.bonusClearCells(),0<this.allElimination.length},highlightElimination:function(){if(0<this.allElimination.length){for(var e=Math.floor(Math.random()*this.allElimination.length),t=this.allElimination[e],n=[],i=0;i<t.cellPosArray.length;i++){var o=t.cellPosArray[i];n.push(this.getCellPosition(o))}this.effectView.playEffectLoop(g.EFFECT_SELECTED,n),this.hintHighlighting=!0}},stopHighlightElimination:function(){this.effectView.stopEffectLoop(g.EFFECT_SELECTED),this.hintHighlighting=!1},getCellPosition:function(e){var t=(e.x-(this.gridModel.width-1)/2)*g.CELL_WIDTH,n=(e.y-(this.gridModel.height-1)/2)*g.CELL_HEIGHT;return cc.v2(t,n)},spawnCellView:function(){return(0<this.cellViewPool.size()?this.cellViewPool.get():cc.instantiate(this.cellViewPrefab)).getComponent("CellView")},despawnCellView:function(e){this.cellViewPool.put(e.node)},onTouchStart:function(e){if(!this.busying){var t=this.convertToCellPos(e);this.gridModel.checkCellPosVaild(t)&&(this.touchCellView=this.cellViews[t.y][t.x],null!=this.touchCellView&&(this.touchCellView.node.scale=.9))}},onTouchEnd:function(e){if(null!=this.touchCellView){this.touchCellView.node.scale=1;var t=this.convertToCellPos(e);t.x==this.touchCellView.cellModel.x&&t.y==this.touchCellView.cellModel.y&&(this.stopHighlightElimination(),this.brushSelected?this.onCellBrushed(t):this.hammerSelected?this.onCellHammered(t):this.onCellClick(t))}},convertToCellPos:function(e){var t=this.cellParent.convertToNodeSpace(e);return{x:Math.round(t.x/g.CELL_WIDTH+(this.gridModel.width-1)/2),y:Math.round(t.y/g.CELL_HEIGHT+(this.gridModel.height-1)/2)}},cellSortCompare:function(e,t){return e.y<t.y?1:e.y>t.y?-1:e.x>t.x?1:e.x<t.x?-1:0},onCellClick:function(e){var s=this,l=this.gridModel.onCellClick(e);l.eliminateSuccess&&function(){var o=5*l.cellPosArray.length,r=o*l.cellPosArray.length;s.score+=r,s.lastExplodBaseType=l.baseType,s.busying=!0,l.cellPosArray.sort(s.cellSortCompare);for(var a=[],e=function(e){var n=l.cellPosArray[e],i=s.cellViews[n.y][n.x];if(null!=i){s.cellViews[n.y][n.x]=null;var t=cc.callFunc(function(){this.despawnCellView(i);var e=i.cellModel,t=this.getCellPosition(n);e.featureType==g.FEATURE_TYPE.Color?this.effectView.playEffectNormal(g.EFFECT_EXPLOD_COLOR,t):e.baseType!=g.BASE_TYPE.Empty&&this.effectView.playEffectExplod(e.baseType-1,t),y.instance.addScore(o,t)},s);a.push(cc.delayTime(.07)),a.push(t)}},t=0;t<l.cellPosArray.length;t++)e(t);var n=cc.callFunc(function(){var e=l.cellPosArray[0],t=l.cellPosArray[l.cellPosArray.length-1],n=this.getCellPosition(e),i=this.getCellPosition(t),o=n.add(i).div(2),a=Math.abs(this.getCellPosition({x:1,y:0}).x);Math.abs(o.x)>a&&(o.x=a*Math.sign(o.x)),y.instance.addScoreTotal(r,o)},s);a.push(n);var i=cc.callFunc(s.onExplodFinished,s);a.push(i),s.node.runAction(cc.sequence(a))}()},onExplodFinished:function(){this.busying=!1,this.cellsFallDown()},cellsFallDown:function(){this.busying=!0;var e=this.gridModel.cellsFallDown(),t=0;if(0<e.length){t=.2;for(var n=0;n<e.length;n++){var i=e[n],o=this.cellViews[i.pos.y][i.pos.x];if(null!=o){this.cellViews[i.pos.y][i.pos.x]=null;var a={x:i.pos.x,y:i.pos.y-i.fallCount};this.cellViews[a.y][a.x]=o;var r=this.getCellPosition(a),s=cc.moveTo(t,r).easing(cc.easeBackIn());o.runActionMove(s)}}}this.scheduleOnce(this.onFallDownFinished,t)},onFallDownFinished:function(){this.busying=!1,this.cellsGather()},cellsGather:function(){this.busying=!0;var e=this.gridModel.cellsGather(),t=0;if(0<e.length){t=.2;for(var n=0;n<e.length;n++){var i=e[n],o=this.cellViews[i.pos.y][i.pos.x];if(null!=o){this.cellViews[i.pos.y][i.pos.x]=null;var a={x:i.pos.x+i.gatherCount,y:i.pos.y};this.cellViews[a.y][a.x]=o;var r=this.getCellPosition(a),s=cc.moveTo(t,r).easing(cc.easeBackIn());o.runActionMove(s)}}}this.scheduleOnce(this.onGatherFinished,t)},onGatherFinished:function(){this.busying=!1,this.changeColorless(),this.checkClear()},checkClear:function(){var o=this,a=this.gridModel.checkClear();this.busying=!0;var r=[],e=!1;if(0<a.length){e=!0;for(var t=function(e){var t=a[e],n=o.cellViews[t.y][t.x];if(null!=n){var i=cc.callFunc(function(){this.despawnCellView(n);var e=this.getCellPosition(t);this.effectView.playEffectNormal(g.EFFECT_EXPLOD_COLOR,e),y.instance.addScore(1e3,e)},o);r.push(cc.delayTime(.1)),r.push(i)}},n=0;n<a.length;n++)t(n);var i=1e3*a.length;this.score+=i;var s=a[0],l=a[a.length-1],c=this.getCellPosition(s),h=this.getCellPosition(l),u=c.add(h).div(2),f=Math.abs(this.getCellPosition({x:2,y:0}).x);Math.abs(u.x)>f&&(u.x=f*Math.sign(u.x));var d=cc.callFunc(function(){y.instance.addScoreTotal(i,u)},this);r.push(d)}var p=cc.callFunc(this.onClearExplodFinished,this,e);0<r.length?(r.push(p),this.node.runAction(cc.sequence(r))):this.node.runAction(p)},onClearExplodFinished:function(e,t){this.busying=!1,t?this.cellsFallDown():this.checkElimination()},changeColorless:function(){if(this.lastExplodBaseType!=g.BASE_TYPE.Empty){var e=this.gridModel.changeColorless(this.lastExplodBaseType);if(0<e.cellPosArray.length)for(var t=0;t<e.cellPosArray.length;t++){var n=e.cellPosArray[t],i=this.cellViews[n.y][n.x];null!=i&&i.changeBaseType(e.baseType)}}},bonusClearCells:function(){var a=this;this.busying=!0;var r=this.gridModel.clearCells(),s=2e3,t=Math.max(0,s-200*r.length);this.score+=t,y.instance.enableScoreBonus(s);var l=[];if(0<r.length){r.sort(this.cellSortCompare),l.push(cc.delayTime(1));for(var e=function(e){var n=r[e],i=a.cellViews[n.y][n.x];if(null!=i){var t=cc.callFunc(function(){var e=i.cellModel,t=this.getCellPosition(n);e.featureType==g.FEATURE_TYPE.Color||e.featureType==g.FEATURE_TYPE.Clear?this.effectView.playEffectNormal(g.EFFECT_EXPLOD_COLOR,t):e.baseType!=g.BASE_TYPE.Empty&&this.effectView.playEffectExplod(e.baseType-1,t),this.despawnCellView(i),0<s&&((s-=200)<=0&&(s=0,y.instance.disableScoreBonus()),y.instance.setScoreBonus(s))},a),o=e<s/200?.3:.1;l.push(cc.delayTime(o)),l.push(t)}},n=0;n<r.length;n++)e(n)}if(0<t){var i=cc.callFunc(function(){var e=this.getCellPosition({x:this.gridModel.width/2,y:this.gridModel.height/2});y.instance.addScore(t,e),y.instance.disableScoreBonus()},this);l.push(i)}var o=cc.callFunc(this.onBonusFinished,this);0<l.length?(l.push(o),this.node.runAction(cc.sequence(l))):this.node.runAction(o)},onBonusFinished:function(){this.busying=!1,this.score>=this.target?this.onNextLevel():this.onGameOver()},onGameOver:function(){this.level<=1?this.onGameOverFinal():this.nodeKeepGoing.active=!0},onNextLevel:function(){var e=this.level+1,t=a.generateLevelInfo(e,this.score);this.initWithLevelInfo(t)},onBtnClickRevive:function(){var e=f.getScreenshotBase64(f.getCameraMain());s.chooseAsync(e).then(function(){this.onGameRevive()}.bind(this)).catch(function(e){})},onGameRevive:function(){this.nodeKeepGoing.active=!1;var e=this.level,t=a.generateLevelInfo(e,this.lastLevelScore);this.initWithLevelInfo(t)},onGameReviveReject:function(){this.onGameOverFinal()},onGameOverFinal:function(){this.nodeKeepGoing.active=!1;var e=this.level;l.instance.incrementData(g.ITEM_DIAMOND,e),l.instance.setData(g.DATA_LEVEL_INFO,""),l.instance.setDataToFB(),s.setLeaderboardAsync(g.LEADERBOARD_SCORE_WORLD,this.score);var t={diamond:e,score:this.score};c.instance.gotoScreen("ScreenGameOver",t)},onCellBrushed:function(e){var t=this.gridModel.onCellBrushed(e);if(0<t.length)for(var n=0;n<t.length;n++){var i=t[n],o=i.getXY(),a=this.cellViews[o.y][o.x];if(null!=a){this.despawnCellView(a);var r=this.spawnCellView();r.node.setParent(this.cellParent),r.node.position=this.getCellPosition(o),r.initWithCellModel(i),this.cellViews[o.y][o.x]=r}}this.screenGame.instance.cancelBtnBrush(),this.effectView.playEffectNormal(g.EFFECT_BRUSH,this.getCellPosition(e)),this.stopHighlightElimination(),this.checkElimination(),this.noTouchTime=0,this.onUseItem(g.ITEM_BRUSH,g.PRICE_BRUSH)},onShuffle:function(){this.busying=!0,this.stopHighlightElimination();for(var e=this.gridModel.onShuffle(),t=[],n=0;n<this.gridModel.height;n++)t[n]=[];for(var i=0;i<e.originArray.length;i++){var o=e.originArray[i],a=o%this.gridModel.width,r=Math.floor(o/this.gridModel.width),s=this.cellViews[r][a];if(null!=s){for(var l=[],c=0;c<e.processArrays.length;c++){var h=e.processArrays[c][i],u={x:h%this.gridModel.width,y:Math.floor(h/this.gridModel.width)};c==e.processArrays.length-1&&(t[u.y][u.x]=s);var f=cc.moveTo(.3,this.getCellPosition(u));l.push(cc.delayTime(.2)),l.push(f)}s.runActionMove(cc.sequence(l))}}this.cellViews=t;var d=.5*e.processArrays.length;this.scheduleOnce(this.onShuffleDone,d),this.onUseItem(g.ITEM_SHUFFLE,g.PRICE_SHUFFLE)},onShuffleDone:function(){this.busying=!1,this.checkElimination()},onCellHammered:function(e){var o=this,a=this.gridModel.onCellHammered(e);this.screenGame.instance.cancelBtnHammer(),this.effectView.playEffectNormal(g.EFFECT_HAMMER,this.getCellPosition(e));var r=[];r.push(cc.delayTime(.5));for(var t=function(e){var n=a[e],i=o.cellViews[n.y][n.x];if(null!=i){var t=cc.callFunc(function(){this.despawnCellView(i);var e=i.cellModel,t=this.getCellPosition(n);e.featureType==g.FEATURE_TYPE.Color||e.featureType==g.FEATURE_TYPE.Clear?this.effectView.playEffectNormal(g.EFFECT_EXPLOD_COLOR,t):e.baseType!=g.BASE_TYPE.Empty&&this.effectView.playEffectExplod(e.baseType-1,t)},o);r.push(t)}},n=0;n<a.length;n++)t(n);var i=cc.callFunc(this.onCellHammerDone,this);r.push(i),this.node.runAction(cc.sequence(r)),this.onUseItem(g.ITEM_HAMMER,g.PRICE_HAMMER)},onCellHammerDone:function(){this.busying=!1,this.cellsFallDown()},onUseItem:function(e,t){0<l.instance.getDataNumber(e)?l.instance.decrementData(e,1):l.instance.getDataNumber(g.ITEM_DIAMOND)>=t&&l.instance.decrementData(g.ITEM_DIAMOND,t),l.instance.setDataToFB()},saveLevelInfo:function(){var e={};e.level=this.level,e.lastLevelScore=this.lastLevelScore,e.score=this.score,e.target=this.target,e.gridModel=this.gridModel;var t=JSON.stringify(e);l.instance.setData(g.DATA_LEVEL_INFO,t),l.instance.setDataToFB()}}),cc._RF.pop()},{"../models/ConstValue":"ConstValue","../models/GridModel":"GridModel","../models/LevelModel":"LevelModel",EffectView:"EffectView",ScoreView:"ScoreView",ScreenGame:"ScreenGame",ScreenMgr:"ScreenMgr",UserDataMgr:"UserDataMgr",UtilsCommon:"UtilsCommon",UtilsFB:"UtilsFB"}],LeaderboardView:[function(e,t,n){"use strict";cc._RF.push(t,"e5ffc6Yk0pBBrPC2jzLJVRT","LeaderboardView");var i=e("UtilsFB");cc.Class({extends:cc.Component,properties:{playerItemPrefab:{default:null,type:cc.Prefab}},onLoad:function(){this.playerItemPool=new cc.NodePool("playerItem"),this.content=this.node.getChildByName("view").getChildByName("content")},showLeaderboard:function(e){"undefined"==typeof FBInstant&&this.showLeaderboardDebug(),i.getLeaderboardAsync(e).then(function(e){this.showLeaderboardInternal(e)}.bind(this)).catch(function(e){})},showLeaderboardDebug:function(){for(var e=new Array,t=0;t<15;t++){var n={id:"2127737910604444"};n.playerName="player "+t,n.score=10+2*t,n.rank=t+1,n.portraitUrl=t%2==0?"https://platform-lookaside.fbsbx.com/platform/instantgames/profile_pic.jpg?igpid=2127737910604444&height=256&width=256&ext=1542184412&hash=AeRpQBaamgXpc3fM":"https://platform-lookaside.fbsbx.com/platform/instantgames/profile_pic.jpg?igpid=2445785048770311&height=256&width=256&ext=1542255362&hash=AeQ_-nxXrs2f6OE4",e.push(n)}this.showLeaderboardInternal(e)},showLeaderboardInternal:function(e){this.node.active=!0,this.updateLeaderboard(e)},updateLeaderboard:function(e){this.clearLeaderboard();for(var t=0;t<e.length;t++){var n=this.spawnPlayerItem();n.getComponent("PlayerItem").updatePlayerInfo(e[t]),n.setParent(this.content)}},clearLeaderboard:function(){for(var e=this.content.childrenCount-1;0<=e;e--)this.despawnPlayerItem(this.content.children[e])},spawnPlayerItem:function(){return 0<this.playerItemPool.size()?this.playerItemPool.get(this):cc.instantiate(this.playerItemPrefab)},despawnPlayerItem:function(e){this.playerItemPool.put(e)}}),cc._RF.pop()},{UtilsFB:"UtilsFB"}],LevelModel:[function(e,t,n){"use strict";cc._RF.push(t,"d4c79j2R4lH847bN+Wf5X9z","LevelModel"),Object.defineProperty(n,"__esModule",{value:!0}),n.generateLevelInfo=function(e,t){var n={};e<=l.LEVEL_CONFIG.length?n=l.LEVEL_CONFIG[e-1]:(n.level=e,n.target=7e3*(e-l.LEVEL_CONFIG.length)+l.LEVEL_CONFIG[l.LEVEL_CONFIG.length-1].target);var i={};i.level=n.level,i.target=n.target,i.score=t||0,i.lastLevelScore=i.score;var o=void 0===n.colorCount?Math.floor(3*Math.random()):n.colorCount,a=void 0===n.colorLessCount?Math.floor(3*Math.random()):n.colorLessCount,r=void 0===n.clearCount?Math.floor(3*Math.random()):n.clearCount;return i.gridModel=new s.default,i.gridModel.init(10,10,o,a,r),i},n.generateLevelInfoFromJson=function(e){var t=JSON.parse(e),n={};return n.level=t.level,n.target=t.target,n.score=t.score,n.lastLevelScore=t.lastLevelScore,n.gridModel=new s.default,n.gridModel.initFromJson(t.gridModel),n};var i,o=e("./GridModel"),s=(i=o)&&i.__esModule?i:{default:i},l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./ConstValue"));cc._RF.pop()},{"./ConstValue":"ConstValue","./GridModel":"GridModel"}],MessageView:[function(e,t,n){"use strict";cc._RF.push(t,"5c11cgY7QVNGLPrR4JdKWHa","MessageView"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.getChildByName("BtnClose").on("click",this.onBtnClickClose,this)},onEnterBegin:function(e){e=e||{},this.onCloseActionArray=[],"onClose"in e&&(this.onCloseActionArray=e.onClose),"message"in e&&this.setMessage(e.message)},onExitBegin:function(e){for(var t=0;t<this.onCloseActionArray.length;t++)this.onCloseActionArray[t]();this.despawnAction&&this.despawnAction(this)},setMessage:function(e){this.node.getChildByName("Bg").getChildByName("Message").getComponent(cc.Label).string=e},onBtnClickClose:function(){this.onExitBegin()}}),cc._RF.pop()},{}],PlayerItem:[function(e,t,n){"use strict";cc._RF.push(t,"d4a40H7rANEeLrdimsBVgJX","PlayerItem");var i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../models/LevelModel"));var o=e("UtilsFB"),a=e("UtilsCommon"),r=e("ScreenMgr");cc.Class({extends:cc.Component,properties:{rank:{default:null,type:cc.Label},portrait:{default:null,type:cc.Sprite},playerName:{default:null,type:cc.Label},score:{default:null,type:cc.Label},btnPlay:{default:null,type:cc.Node},btnPlayLabel:{default:null,type:cc.Label}},onLoad:function(){this.node.on("click",this.onBtnClick,this),this.defaultPortraitSprite=this.portrait.spriteFrame},onBtnClick:function(){var e=a.getScreenshotBase64(a.getCameraMain());this.playerData.isSelf?o.chooseAsync(e).catch(function(e){}):o.invitePlayerAsync(this.playerData.id,e).then(function(){this.playGame()}.bind(this)).catch(function(e){this.playGame()}.bind(this))},playGame:function(){r.instance.closeAllDialog();var e={levelInfo:i.generateLevelInfo(1)};r.instance.gotoScreen("ScreenGame",e)},updatePlayerInfo:function(e){this.playerData=e,this.rank.string=e.rank,this.playerName.string=e.playerName,this.score.string=e.score,o.getPlayerPhotoAsync(e).then(function(){null!=e.photoTexture&&(this.portrait.spriteFrame=new cc.SpriteFrame,this.portrait.spriteFrame.setTexture(e.photoTexture))}.bind(this)).catch(function(e){}),this.btnPlayLabel.string=this.playerData.isSelf?"Share":"Play"}}),cc._RF.pop()},{"../models/LevelModel":"LevelModel",ScreenMgr:"ScreenMgr",UtilsCommon:"UtilsCommon",UtilsFB:"UtilsFB"}],ScoreView:[function(e,t,n){"use strict";cc._RF.push(t,"9abd8NJq0VD/INxgW7NN79m","ScoreView");var i=cc.Class({extends:cc.Component,properties:{nodeLevel:{default:null,type:cc.Node},scoreTarget:{default:null,type:cc.Node},scoreCurrent:{default:null,type:cc.Node},scoreBonus:{default:null,type:cc.Node},scoreCellPrefab:{default:null,type:cc.Prefab},scoreCellParent:{default:null,type:cc.Node},scoreTotalPrefab:{default:null,type:cc.Prefab},scoreTotalParent:{default:null,type:cc.Node}},statics:{instance:null},onLoad:function(){(i.instance=this).scoreCellPool=new cc.NodePool("ScoreCell"),this.scoreTotalPool=new cc.NodePool("ScoreTotal")},initWithLevelInfo:function(e){this.nodeLevel.getComponentInChildren(cc.Label).string="LV: "+e.level,this.nodeLevel.getComponentInChildren(cc.Animation).play(),this.scoreTarget.getComponent(cc.Label).string="Target: "+e.target,this.scoreTarget.getComponent(cc.Animation).play(),this.scoreCurrentInt=e.score,this.scoreCurrent.getComponent(cc.Label).string=this.scoreCurrentInt.toString()},addScore:function(e,t){var n=this.spawnScoreCell();n.getComponent(cc.Label).string=e.toString(),n.position=t;var i=this.scoreCurrent.position,o=cc.moveTo(.8,i).easing(cc.easeCircleActionIn()),a=cc.callFunc(function(){this.scoreCurrentInt+=e,this.scoreCurrent.getComponent(cc.Label).string=this.scoreCurrentInt.toString(),this.scoreCurrent.getComponent(cc.Animation).play(),this.despawnScoreCell(n)},this);n.runAction(cc.sequence(o,a))},addScoreTotal:function(e,t){var n=this.spawnScoreTotal();n.position=t,n.getComponentInChildren(cc.Label).string=e.toString(),n.getComponent(cc.Animation).play()},enableScoreBonus:function(e){this.scoreBonus.getComponent(cc.Label).string=e.toString(),this.scoreBonus.active=!0,this.scoreBonus.opacity=255},setScoreBonus:function(e){this.scoreBonus.getComponent(cc.Label).string=e.toString(),this.scoreBonus.getComponent(cc.Animation).play()},disableScoreBonus:function(){var e=cc.fadeOut(1),t=cc.callFunc(function(){this.scoreBonus.active=!1},this);this.scoreBonus.runAction(cc.sequence(e,t))},spawnScoreCell:function(){var e=null;return(e=0<this.scoreCellPool.size()?this.scoreCellPool.get():cc.instantiate(this.scoreCellPrefab)).setParent(this.scoreCellParent),e},despawnScoreCell:function(e){this.scoreCellPool.put(e)},spawnScoreTotal:function(){var n=null;return 0<this.scoreTotalPool.size()?n=this.scoreTotalPool.get():(n=cc.instantiate(this.scoreTotalPrefab)).getComponent(cc.Animation).on("finished",function(e,t){this.scoreTotalPool.put(n)},this),n.setParent(this.scoreTotalParent),n}});cc._RF.pop()},{}],ScreenGameOVer:[function(e,t,n){"use strict";cc._RF.push(t,"cc8c6j5OTFL8IqmKg7fgsJP","ScreenGameOVer");var i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../models/ConstValue"));var o=e("ScreenMgr");cc.Class({extends:e("ScreenView"),properties:{labelScore:{default:null,type:cc.Label},labelDiamond:{default:null,type:cc.Label},leaderboardView:{default:null,type:e("LeaderboardView")}},onEnterBegin:function(e){this.labelScore.string=e.score.toString(),this.labelDiamond.string="+"+e.diamond,this.leaderboardView.showLeaderboard(i.LEADERBOARD_SCORE_WORLD)},onBtnClickClose:function(){o.instance.gotoScreen("ScreenHome")}}),cc._RF.pop()},{"../models/ConstValue":"ConstValue",LeaderboardView:"LeaderboardView",ScreenMgr:"ScreenMgr",ScreenView:"ScreenView"}],ScreenGame:[function(e,t,n){"use strict";cc._RF.push(t,"d9de2vD1ypPD5GZE6KiWaj2","ScreenGame");var i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../models/ConstValue"));var l=e("UserDataMgr"),o=e("ScreenMgr"),a=cc.Class({extends:e("ScreenView"),properties:{gridView:{default:null,type:e("GridView")},dialogPause:{default:null,type:cc.Node},btnBrush:{default:null,type:cc.Node},btnLoop:{default:null,type:cc.Node},btnHammer:{default:null,type:cc.Node},labelDiamond:{default:null,type:cc.Node}},statics:{instance:null},onLoad:function(){(a.instance=this).btnBrush.getChildByName("Button").on("click",this.onBtnClickBrush,this),this.btnLoop.getChildByName("Button").on("click",this.onBtnClickLoop,this),this.btnHammer.getChildByName("Button").on("click",this.onBtnClickHammer,this),this.labelDiamond.getChildByName("Button").on("click",this.onBtnClickAddDiamond,this)},start:function(){l.instance.node.on("data_change",this.onDataChange,this)},onDataChange:function(e){if(this.node.active){var t=e.key;t!=i.ITEM_BRUSH&&t!=i.ITEM_HAMMER&&t!=i.ITEM_SHUFFLE&&t!=i.ITEM_DIAMOND||this.updateItemInfo()}},onEnterBegin:function(e){this.gridView.initWithLevelInfo(e.levelInfo),this.updateItemInfo()},onExitBegin:function(e){this.gridView.clearOnExit()},onBtnClickPause:function(){this.gridView.busying||(this.cancelBtnBrush(),this.cancelBtnHammer(),this.dialogPause.active=!0)},onBtnClickBrush:function(){this.gridView.busying||(this.cancelBtnHammer(),this.gridView.brushSelected?this.cancelBtnBrush():this.checkLeftItemCount(i.ITEM_BRUSH,i.PRICE_BRUSH)&&(this.btnBrush.getChildByName("Button").getComponent("SpriteSwitch").switchSprite(),this.gridView.brushSelected=!this.gridView.brushSelected))},cancelBtnBrush:function(){this.gridView.brushSelected&&(this.gridView.brushSelected=!1,this.btnBrush.getChildByName("Button").getComponent("SpriteSwitch").switchSprite())},onBtnClickLoop:function(){this.gridView.busying||(this.cancelBtnBrush(),this.cancelBtnHammer(),this.checkLeftItemCount(i.ITEM_SHUFFLE,i.PRICE_SHUFFLE)&&this.gridView.onShuffle())},onBtnClickHammer:function(){this.gridView.busying||(this.cancelBtnBrush(),this.gridView.hammerSelected?this.cancelBtnHammer():this.checkLeftItemCount(i.ITEM_HAMMER,i.PRICE_HAMMER)&&(this.btnHammer.getChildByName("Button").getComponent("SpriteSwitch").switchSprite(),this.gridView.hammerSelected=!this.gridView.hammerSelected))},cancelBtnHammer:function(){this.gridView.hammerSelected&&(this.gridView.hammerSelected=!1,this.btnHammer.getChildByName("Button").getComponent("SpriteSwitch").switchSprite())},checkLeftItemCount:function(e,t){return 0<l.instance.getDataNumber(e)||(t<=l.instance.getDataNumber(i.ITEM_DIAMOND)||(this.onBtnClickAddDiamond(),!1))},onBtnClickAddDiamond:function(){this.gridView.busying||o.instance.showDialog("DialogGetDiamond")},updateItemInfo:function(){this.updateDiamond(),this.updateItemButton(this.btnBrush,i.ITEM_BRUSH,i.PRICE_BRUSH),this.updateItemButton(this.btnLoop,i.ITEM_SHUFFLE,i.PRICE_SHUFFLE),this.updateItemButton(this.btnHammer,i.ITEM_HAMMER,i.PRICE_HAMMER)},updateDiamond:function(){this.labelDiamond.getComponentInChildren(cc.Label).string=l.instance.getDataNumber(i.ITEM_DIAMOND).toString()},updateItemButton:function(e,t,n){var i=l.instance.getDataNumber(t),o=e.getChildByName("SpriteCount"),a=e.getChildByName("SpriteDiamond"),r=e.getChildByName("Label");o.active=0<i,a.active=!(0<i);var s="";0<i?(o.active=!0,a.active=!1,s=i.toString()):(o.active=!1,a.active=!0,s=n.toString()),r.getComponent(cc.Label).string=s}});cc._RF.pop()},{"../models/ConstValue":"ConstValue",GridView:"GridView",ScreenMgr:"ScreenMgr",ScreenView:"ScreenView",UserDataMgr:"UserDataMgr"}],ScreenHome:[function(e,t,n){"use strict";cc._RF.push(t,"cd1ealmlBVBNYA6GgPYwP3Z","ScreenHome");var i=a(e("../models/LevelModel")),o=a(e("../models/ConstValue"));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var r=e("ScreenMgr"),s=e("UserDataMgr");cc.Class({extends:e("ScreenView"),properties:{btnContinue:{default:null,type:cc.Node}},onLoad:function(){},start:function(){s.instance.node.on("data_load",this.onDataLoad,this)},onEnterBegin:function(e){this.updateBtnContinue()},onBtnNew:function(){var e={levelInfo:i.generateLevelInfo(1)};r.instance.gotoScreen("ScreenGame",e)},onBtnClickContinue:function(){var e=s.instance.getDataString(o.DATA_LEVEL_INFO);if(""!=e){var t={levelInfo:i.generateLevelInfoFromJson(e)};r.instance.gotoScreen("ScreenGame",t)}},onBtnClickGift:function(){r.instance.showDialog("DialogDailyGift")},onBtnClickRank:function(){r.instance.showDialog("DialogLeaderboard")},onDataLoad:function(){this.updateBtnContinue()},updateBtnContinue:function(){var e=""==s.instance.getDataString(o.DATA_LEVEL_INFO)?0:1;this.btnContinue.getComponent("SpriteSwitch").switchSpriteTo(e)}}),cc._RF.pop()},{"../models/ConstValue":"ConstValue","../models/LevelModel":"LevelModel",ScreenMgr:"ScreenMgr",ScreenView:"ScreenView",UserDataMgr:"UserDataMgr"}],ScreenMgr:[function(e,t,n){"use strict";cc._RF.push(t,"f202eQwzh9KXrmiGdnhgqH2","ScreenMgr");var o=cc.Class({extends:cc.Component,properties:{layerScreen:{default:null,type:cc.Node},layerDialog:{default:null,type:cc.Node},layerMessage:{default:null,type:cc.Node},prefabMessage:{default:null,type:cc.Prefab}},statics:{instance:null},onLoad:function(){(o.instance=this).screensMap=new Map,this.screenCurrent="ScreenHome";for(var e=0;e<this.layerScreen.childrenCount;e++){var t=this.layerScreen.children[e];this.screensMap.set(t.name,t)}this.dialogsMap=new Map;for(var n=0;n<this.layerDialog.childrenCount;n++){var i=this.layerDialog.children[n];this.dialogsMap.set(i.name,i)}this.messagePool=new cc.NodePool("MessageView")},gotoScreen:function(e,t){if(this.screensMap.has(e)){if(t=t||{},this.screensMap.has(this.screenCurrent)){t.screenFrom=this.screenCurrent;var n=this.screensMap.get(this.screenCurrent),i={screenTo:e};n.getComponent("ScreenView").onExitBegin(i),n.active=!1}this.screenCurrent=e;var o=this.screensMap.get(e);o.active=!0,o.getComponent("ScreenView").onEnterBegin(t)}},showDialog:function(e,t){if(this.dialogsMap.has(e)){t=t||{};var n=this.dialogsMap.get(e);n.active=!0,n.getComponent("DialogView").onEnterBegin(t)}},closeAllDialog:function(e){e=e||{};var t=!0,n=!1,i=void 0;try{for(var o,a=this.dialogsMap.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;r.active&&(r.active=!1)}}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}},showMessage:function(e){var t=null;(t=0<this.messagePool.size()?this.messagePool.get():cc.instantiate(this.prefabMessage)).setParent(this.layerMessage);var n=t.getComponent("MessageView");n.despawnAction=this.despawnMessage.bind(this);var i={message:e};n.onEnterBegin(i)},despawnMessage:function(e){this.messagePool.put(e.node)}});cc._RF.pop()},{}],ScreenView:[function(e,t,n){"use strict";cc._RF.push(t,"dd7f5DkXhRBAJg4myaXRlna","ScreenView"),cc.Class({extends:cc.Component,properties:{},onEnterBegin:function(e){},onExitBegin:function(e){}}),cc._RF.pop()},{}],SpriteSwitch:[function(e,t,n){"use strict";cc._RF.push(t,"d22dahIlOxAj5m0tfmNBLU7","SpriteSwitch"),cc.Class({extends:cc.Component,properties:{spritesArray:{default:[],type:[cc.SpriteFrame]}},onLoad:function(){this.currentSpriteIndex=0},switchSprite:function(){this.currentSpriteIndex+=1,this.getComponent(cc.Sprite).spriteFrame=this.spritesArray[this.currentSpriteIndex%this.spritesArray.length]},switchSpriteTo:function(e){this.currentSpriteIndex=e%this.spritesArray.length,this.getComponent(cc.Sprite).spriteFrame=this.spritesArray[this.currentSpriteIndex%this.spritesArray.length]}}),cc._RF.pop()},{}],UserDataMgr:[function(e,t,n){"use strict";cc._RF.push(t,"f71fcMdx7dE053qUEPcvT1V","UserDataMgr");var i=cc.Class({extends:cc.Component,properties:{},statics:{instance:null},onLoad:function(){(i.instance=this).userData={},this.getDataFromFB()},start:function(){},setData:function(e,t){this.userData[e]=t,this.node.emit("data_change",{key:e})},getDataString:function(e){return e in this.userData?this.userData[e]:""},getDataNumber:function(e){return e in this.userData?this.userData[e]:0},incrementData:function(e,t){this.setData(e,this.getDataNumber(e)+t)},decrementData:function(e,t){this.setData(e,this.getDataNumber(e)-t)},getDataFromFB:function(){"undefined"!=typeof FBInstant&&FBInstant.player.getDataAsync(["data"]).then(function(e){"data"in e&&(this.userData=e.data),this.node.emit("data_load")}.bind(this))},setDataToFB:function(){"undefined"!=typeof FBInstant&&FBInstant.player.setDataAsync({data:this.userData}).then(function(){console.log("[udm]Data is set")})}});cc._RF.pop()},{}],UtilsCommon:[function(e,t,n){"use strict";cc._RF.push(t,"6d201UzVudPAZ7Hg/Dz2RrW","UtilsCommon");var i=cc.Class({extends:cc.Component,statics:{_cameraMain:null,getCameraMain:function(){return null==i._cameraMain&&(i._cameraMain=cc.find("Canvas/Main Camera").getComponent(cc.Camera)),i._cameraMain},getScreenshotBase64:function(e){var t=new cc.RenderTexture,n=cc.game._renderContext;t.initWithSize(cc.visibleRect.width,cc.visibleRect.height,n.STENCIL_INDEX8),e.targetTexture=t,e.render(),e.targetTexture=null;var i=t.readPixels(),o=document.createElement("canvas"),a=o.getContext("2d");o.width=t.width,o.height=t.height;for(var r=t.width,s=t.height,l=4*r,c=0;c<s;c++){for(var h=s-1-c,u=a.createImageData(r,1),f=h*r*4,d=0;d<l;d++)u.data[d]=i[f+d];a.putImageData(u,0,c)}return o.toDataURL("image/jpeg")},shuffleArray:function(e){for(var t=e.length-1;0<t;t--){var n=Math.floor(Math.random()*(t+1)),i=[e[n],e[t]];e[t]=i[0],e[n]=i[1]}return e}}});cc._RF.pop()},{}],UtilsFB:[function(e,t,n){"use strict";cc._RF.push(t,"0bafcXYS/tEjZh8b5oqHoER","UtilsFB");var l=cc.Class({extends:cc.Component,statics:{leaderboardMapLocal:{},init:function(e){l.getLeaderboardAsync(e).catch(function(e){})},invitePlayerRandomAsync:function(o){return new Promise(function(n,i){"undefined"!=typeof FBInstant?FBInstant.player.getConnectedPlayersAsync().then(function(e){if(e.length){var t=e[Math.floor(Math.random()*e.length)].getID();l.invitePlayerAsync(t,o).then(function(){n()}).catch(function(e){i(e)})}else l.debugLog("getConnectedPlayersAsync error: player count 0."),i("Player count is 0.")}).catch(function(e){l.debugLog("getConnectedPlayersAsync error: "+JSON.stringify(e)),i(e)}):i("FBInstant undefined")})},invitePlayerAsync:function(n,i){return new Promise(function(e,t){"undefined"!=typeof FBInstant?FBInstant.context.createAsync(n).then(function(){FBInstant.updateAsync({action:"CUSTOM",cta:"Join the Game",image:i,text:{default:"Play with me",localizations:{}},template:"VILLAGE_INVASION",strategy:"IMMEDIATE",notification:"NO_PUSH",data:{createId:n}}).then(function(){e()}).catch(function(e){l.debugLog("updateAsync error: "+JSON.stringify(e)),t(e)})}).catch(function(e){l.debugLog("createAsync error: "+JSON.stringify(e)),t(e)}):t("FBInstant undefined")})},getLeaderboardAsync:function(s){return l.debugLog("getLeaderboardAsync"),new Promise(function(r,t){if("undefined"!=typeof FBInstant){var e=l.getLeaderboardLocal(s);null!=e&&(l.debugLog("getLeaderboardAsync local"),r(e)),FBInstant.getLeaderboardAsync(s).then(function(e){return l.debugLog("getLeaderboardAsync leaderboard: "+JSON.stringify(e)),e.getConnectedPlayerEntriesAsync(10,0)}).then(function(e){l.debugLog("getConnectedPlayerEntriesAsync entries: "+JSON.stringify(e));for(var t=new Array,n=l.getSelfLeaderboardScore(),i=0;i<e.length;i++){var o={},a=e[i].getPlayer();o.isSelf=a.getID()==FBInstant.player.getID(),o.id=a.getID(),o.playerName=a.getName(),o.photoUrl=a.getPhoto(),o.isSelf?o.score=Math.max(n,e[i].getScore()):o.score=e[i].getScore(),o.rank=e[i].getRank(),o.photoTexture=null,t.push(o)}l.updateLeaderboardLocal(s,t),r(t)}).catch(function(e){l.debugLog("getLeaderboardAsync error: "+JSON.stringify(e)),t(e)})}else t("FBInstant undefined")})},loadPlayerArrayPhoto:function(e){if(l.debugLog("loadPlayerArrayPhoto"),null!=e)for(var t=0;t<e.length;t++)l.loadPlayerPhotoAsync(e[t]).catch(function(e){})},loadPlayerPhotoAsync:function(o){return new Promise(function(n,i){cc.loader.load({url:o.photoUrl,type:"jpg"},function(e,t){null!=t?(o.photoTexture=t,n()):(l.debugLog("loadPlayerPhotoAsync error: "+JSON.stringify(e)),i(e))})})},setLeaderboardAsync:function(n,i){return l.debugLog("setLeaderboardAsync"),new Promise(function(e,t){"undefined"!=typeof FBInstant?(l.setLeaderboardLocal(n,i)&&e(),FBInstant.getLeaderboardAsync(n).then(function(e){return e.setScoreAsync(i)}).then(function(){e()}).catch(function(e){l.debugLog("setLeaderboardAsync error: "+JSON.stringify(e)),t(e)})):t("FBInstant undefined")})},getPlayerPhotoAsync:function(n){return new Promise(function(e,t){null!=n.photoTexture?e():l.loadPlayerPhotoAsync(n).then(function(){e()}).catch(function(e){l.debugLog("getPlayerPhotoAsync error: "+JSON.stringify(e)),t(e)})})},getLeaderboardLocal:function(e){return e in l.leaderboardMapLocal?l.leaderboardMapLocal[e].playerArray:null},updateLeaderboardLocal:function(e,t){l.debugLog("updateLeaderboardLocal: "+e),e in l.leaderboardMapLocal||(l.leaderboardMapLocal[e]={}),l.leaderboardMapLocal[e].playerArray=t,l.loadPlayerArrayPhoto(l.leaderboardMapLocal[e].playerArray)},setLeaderboardLocal:function(e,t){var n=null;e in l.leaderboardMapLocal||(l.leaderboardMapLocal[e]={},l.leaderboardMapLocal[e].playerArray=new Array),n=l.leaderboardMapLocal[e].playerArray;for(var i=null,o=0;o<n.length;o++){var a=n[o];a.id==FBInstant.player.getID()&&(i=a)}var r=!1;if(null==i?((i={isSelf:!0}).id=FBInstant.player.getID(),i.playerName=FBInstant.player.getName(),i.photoUrl=FBInstant.player.getPhoto(),i.score=t,i.rank=0,i.photoTexture=null,n.push(i),r=!0):t>i.score&&(i.score=t,r=!0),r){n.sort(function(e,t){var n=e.score,i=t.score;return n<i?1:i<n?-1:0});for(var s=0;s<n.length;s++)n[s].rank=s+1}return!1},getPlayerInfoScoreOvertake:function(e,t,n){var i=[],o=l.getLeaderboardLocal(e);if(null!=o)for(var a=0;a<o.length;a++){var r=o[a],s=r.score;t<=s&&s<n&&i.push(r)}return i},getSelfLeaderboardScore:function(e){var t=l.getLeaderboardLocal(e);if(null!=t)for(var n=0;n<t.length;n++){var i=t[n];if(i.isSelf)return i.score}return-1},shareAsync:function(n,i){return new Promise(function(e,t){"undefined"!=typeof FBInstant?FBInstant.shareAsync({intent:"SHARE",image:i,text:n,data:{myReplayData:"..."}}).then(function(){e()}).catch(function(e){l.debugLog("shareAsync error: "+JSON.stringify(e)),t(e)}):t("FBInstant undefined")})},chooseAsync:function(n,i){return new Promise(function(e,t){"undefined"!=typeof FBInstant?(i=i||[],FBInstant.context.chooseAsync({filters:i}).then(function(){FBInstant.updateAsync({action:"CUSTOM",cta:"Join the Game",image:n,text:{default:"Play with me",localizations:{}},template:"VILLAGE_INVASION",strategy:"IMMEDIATE",notification:"NO_PUSH",data:{}}).then(function(){l.debugLog("chooseAsync success."),e()}).catch(function(e){l.debugLog("chooseAsync updateAsync error: "+JSON.stringify(e)),t(e)})}).catch(function(e){l.debugLog("chooseAsync error: "+JSON.stringify(e)),t(e)})):t("FBInstant undefined")})},debugLog:function(e){}}});cc._RF.pop()},{}]},{},["GameControl","CellModel","ConstValue","GridModel","GridModellTest","LevelModel","UtilsCommon","UtilsFB","AudioMgr","CellView","DialogDailyGift","DialogGetDiamond","DialogLeaderboard","DialogPause","DialogView","EffectMgr","EffectView","GameMgr","GridView","LeaderboardView","MessageView","PlayerItem","ScoreView","ScreenGame","ScreenGameOVer","ScreenHome","ScreenMgr","ScreenView","SpriteSwitch","UserDataMgr"]);